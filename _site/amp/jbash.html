<!doctype html>
<html amp lang="en">
<head>
    <meta charset="utf-8">
    <title>Introducing jBash</title>
    <link rel="canonical" href="https://www.geekytidbits.com/jBash/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Poly' rel='stylesheet'>
    <style amp-custom>
        body { font-family: 'Poly', serif; }
        .site-header { background-color: #237ab2; color: #e7e9ec; padding: 5px; font-weight: 100; border-bottom: 3px solid #f68905; }
        .site-description { font-size: .5em;}        
        .post-content { padding: 10px; }
    </style>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
    <script async custom-element="amp-video" src="https://cdn.ampproject.org/v0/amp-video-0.1.js"></script>
    <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
</head>

<body>
    
    <h1 class="post-title">
        <header class="site-header">
    <div class="wrapper">
        <a class="site-title" href="/">
            <amp-img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo" layout="responsive"><noscript><img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo"></noscript></amp-img>
        </a>
        <div class="site-description">Tidbits on software development, technology, and other geeky stuff.</div>
    </div>
</header>

    </h1>
    <div class="post-content">
      <span>
          <i>Sep 28, 2017</i>
      </span>
      <p>I love Bash. I hate Bash.</p>

<p>Yeah, that sums of up relationship with Bash pretty well, when it comes to using it for writing shell scripts. The great (and horrible) thing about Bash is that it is bare metal. Using Bash for shell scripts is great because it is such a small abstaction from the commands you are actually going to be running. Want to write a release script for your OSS project to build, package, and upload it to your favorite package manager and then create an associated GitHub release? Bash is a natrual tool for this since you can use it to orchestrate simply calling the various commands to do what you need, just as if you were typing the commands into the shell manually. But, if you go beyond anything basic, things get confusing <em>fast</em>. I can barely write anything in Bash non-trival without doing a Google search. To me, that’s a problem.</p>

<h2 id="bash-pitfalls">Bash Pitfalls</h2>

<p>Just take a look at this <a href="http://mywiki.wooledge.org/BashPitfalls">list of Bash Pitfalls</a>. The description says “This page shows <strong>common</strong> errors that Bash programmers make”. <strong>Common</strong> errors! Want to simply echo your variable to the shell with something like <code class="highlighter-rouge">echo $foo</code>? Not so fast, because you might run into <a href="http://mywiki.wooledge.org/BashPitfalls#echo_.24foo">WordSplitting and/or globbing concerns</a>. How about looping through a list of files and running a command with each with something like:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for </span>i <span class="k">in</span> <span class="k">$(</span><span class="nb">ls</span> <span class="k">*</span>.mp3<span class="k">)</span><span class="p">;</span> <span class="k">do</span>    <span class="c"># Wrong!</span>
  some <span class="nb">command</span> <span class="nv">$i</span>           <span class="c"># Wrong!</span>
<span class="k">done</span>
</code></pre></div></div>

<p>Nope - there are <a href="http://mywiki.wooledge.org/BashPitfalls#for_i_in_.24.28ls_.2A.mp3.29">at least 6 problems</a> with that syntax.</p>

<h2 id="javascript">JavaScript</h2>

<p>I love JavaScript and the npm ecosystem but IMHO, using JavaScript in Node.js isn’t an entirely pleasant or clean solution for writing shell scripts. You have asynchronous, error handling, and encoding concerns along with a verbose <a href="https://nodejs.org/api/child_process.html#child_process_child_process">child_process</a> interface. For example, to get the Node.js version, you might write something like this:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span> <span class="nx">execFile</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"child_process"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">child</span> <span class="o">=</span> <span class="nx">execFile</span><span class="p">(</span><span class="s2">"node"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"--version"</span><span class="p">],</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">,</span> <span class="nx">stderr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">stdout</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>That is pretty verbose, honestly. In Bash, it’s as simple as this:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="k">$(</span>node <span class="nt">--version</span><span class="k">)</span>
</code></pre></div></div>

<p>A one liner! It’s so clean and simple in Bash.</p>

<h2 id="jbash">jBash</h2>

<p>Wouldn’t it be nice to have the best of both worlds? The simplicity and terseness of Bash with the pleasant and familiar syntax of JavaScript? Also, wouldn’t it be nice if we could tap into npm packages easily to use them from our shell scripts? There is a package for just about everything, anyway.</p>

<p>Those were my thoughts and so I wrote jBash. It’s a simple JavaScript library that adds Bash like helpers for writing shell scripts in JavaScript. It abstracts some of the verbosity of JavaScript and matches the sytax of your favorite commands in Bash.</p>

<p>Want to echo a variable to the console? It’s easy with:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">echo</span><span class="p">(</span><span class="nx">foo</span><span class="p">);</span>
</code></pre></div></div>

<p>How about the syntax to get the version of Node.js, like I showed above. Easy:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">echo</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">`node --version`</span><span class="p">));</span>
</code></pre></div></div>

<p>jBash has helpers for arguments passed into the script ($1, $2), environmental variables ($HOME), and running commands. Also, there are some extended helpers for reading and writing files, setting verbosity level and error handling.</p>

<h3 id="helpers">Helpers</h3>

<p>Here is the full list of helpers.</p>

<table>
  <thead>
    <tr>
      <th>Bash</th>
      <th>jBash</th>
      <th>notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">echo "Hello"</code></td>
      <td><code class="highlighter-rouge">echo("Hello")</code></td>
      <td>print text to console</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">$1, $2, ...</code></td>
      <td><code class="highlighter-rouge">$1; $2; ...</code></td>
      <td>$1, $2, etc. variables contain args passed in</td>
    </tr>
    <tr>
      <td> </td>
      <td><code class="highlighter-rouge">args[0], args[1]</code></td>
      <td>arguments passed in are also in args array</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">$0</code></td>
      <td><code class="highlighter-rouge">$0</code></td>
      <td>file path of current script</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">$HOME</code></td>
      <td><code class="highlighter-rouge">$HOME</code></td>
      <td>environment variables</td>
    </tr>
    <tr>
      <td> </td>
      <td><code class="highlighter-rouge">env.HOME</code></td>
      <td>all env variables are also mapped on env var</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">set -x</code></td>
      <td><code class="highlighter-rouge">set("-x")</code></td>
      <td>echos all commands</td>
    </tr>
    <tr>
      <td> </td>
      <td><code class="highlighter-rouge">options.xtrace=true</code></td>
      <td>alternative to set(“-x”)</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">set -e</code></td>
      <td><code class="highlighter-rouge">set("-e")</code></td>
      <td>throw when a command exits with non-zero status</td>
    </tr>
    <tr>
      <td> </td>
      <td><code class="highlighter-rouge">options.errexit=true</code></td>
      <td>alternative to set(“-x”)</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">cd "/usr/bin"</code></td>
      <td><code class="highlighter-rouge">cd("/usr/bin")</code></td>
      <td>change current working directory</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">exit 1</code></td>
      <td><code class="highlighter-rouge">exit(1)</code></td>
      <td>exit with code</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">result=$(cmd.sh)</code></td>
      <td><code class="highlighter-rouge">result=$(`cmd.sh`)</code></td>
      <td>$(…) buffers output as return value</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">eval ping g.cn</code></td>
      <td><code class="highlighter-rouge">eval(`ping g.cn`)</code></td>
      <td>eval() streams output to console (no return value)</td>
    </tr>
    <tr>
      <td> </td>
      <td><code class="highlighter-rouge">exec(`ping g.cn`)</code></td>
      <td>exec() is an alias for eval()</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">config=$(cat cnf.txt)</code></td>
      <td><code class="highlighter-rouge">config=$(`cat cnf.txt`)</code></td>
      <td>read text from file</td>
    </tr>
    <tr>
      <td> </td>
      <td><code class="highlighter-rouge">config=readFile(`cnf.txt`)</code></td>
      <td>readFile reads file to text</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">echo $cnf &gt; cnf.txt</code></td>
      <td><code class="highlighter-rouge">$(`echo ${cnf} &gt; cnf.txt`)</code></td>
      <td>save text to file</td>
    </tr>
    <tr>
      <td> </td>
      <td><code class="highlighter-rouge">writeFile(`cnf.txt`, cnf)</code></td>
      <td>writeFile saves text to file</td>
    </tr>
  </tbody>
</table>

<h2 id="use-it">Use It</h2>

<p>The GitHub repository is located here: <a href="https://github.com/bradymholt/jBash">https://github.com/bradymholt/jBash</a>. Enjoy!</p>

    </div>
    
    <footer class="site-footer">
    © 2019 Brady Holt
</footer>

    <amp-analytics type="googleanalytics">
        <script type="application/json">
        {
            "vars": {
            "account": "UA-19416043-2"
            },
            "triggers": {
            "trackPageview": {
                "on": "visible",
                "request": "pageview"
            }
            }
        }
        </script>
    </amp-analytics>
</body>

</html>