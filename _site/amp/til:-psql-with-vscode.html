<!doctype html>
<html amp lang="en">
<head>
    <meta charset="utf-8">
    <title>TIL: psql with VS Code</title>
    <link rel="canonical" href="https://www.geekytidbits.com/til:-psql-with-vscode/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Poly' rel='stylesheet'>
    <style amp-custom>
        body { font-family: 'Poly', serif; }
        .site-header { background-color: #237ab2; color: #e7e9ec; padding: 5px; font-weight: 100; border-bottom: 3px solid #f68905; }
        .site-description { font-size: .5em;}        
        .post-content { padding: 10px; }
    </style>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
    <script async custom-element="amp-video" src="https://cdn.ampproject.org/v0/amp-video-0.1.js"></script>
    <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
</head>

<body>
    
    <h1 class="post-title">
        <header class="site-header">
    <div class="wrapper">
        <a class="site-title" href="/">
            <amp-img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo" layout="responsive"><noscript><img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo"></noscript></amp-img>
        </a>
        <div class="site-description">Tidbits on software development, technology, and other geeky stuff.</div>
    </div>
</header>

    </h1>
    <div class="post-content">
      <span>
          <i>Feb 1, 2018</i>
      </span>
      <p>I was catching up on my Feedly yesterday and ran across <a href="http://www.craigkerstiens.com/2018/01/31/postgres-hidden-gems/">Postgres Hidden Gems</a> by Craig Kerstein.  There are some really neat things in that list!
One thing that caught my eye was this one:</p>

<blockquote>
  <p>@l_avrot – The fact that we can use vim editor in psql</p>
</blockquote>

<p>Really?  I didn’t know that.  Tell me more.  So I Googled a bit and of course another post from Craig titled <a href="http://www.craigkerstiens.com/2013/02/13/How-I-Work-With-Postgres/">How I Work With Postgres – Psql, My PostgreSQL Admin</a> popped up.  Here, he explains how to use <code class="highlighter-rouge">\e</code> in psql to “allow you to view and edit your last run query in your editor of choice”.  That sounds really useful, especially when working with longer, more involved queries.</p>

<p>My “editor of choice” is <a href="https://code.visualstudio.com/">VS Code</a> and when I attempted to use <code class="highlighter-rouge">\e</code> with my <code class="highlighter-rouge">EDITOR</code> var set to “code” it did not work.  The current query was not passed to VS Code and when saving the file from VS Code, nothing got sent back to psql.</p>

<p>More Googling and fiddling and I found that I needed to add the <code class="highlighter-rouge">-w</code> parameter when launching VS Code so that it would “Wait for the files to be closed before returning.”, per the <code class="highlighter-rouge">--help</code> output.  Also, I learned that you can use <code class="highlighter-rouge">PSQL_EDITOR</code> to set the editor specific to psql, which I prefer because I like keeping <code class="highlighter-rouge">EDITOR</code> set to vim for varios shell things.  Editing SQL, however, I would much prefer to do in VS Code rather than vim, thank you very much.  So, now I have the following environment variable defined in my .zshrc:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export PSQL_EDITOR="code -w"
</code></pre></div></div>

<p>Now when I enter <code class="highlighter-rouge">\e</code> from psql, VS Code launches with the contents of my current or last executed query and saving the file results in psql executing the query.  Awesome!</p>

    </div>
    
    <footer class="site-footer">
    © 2019 Brady Holt
</footer>

    <amp-analytics type="googleanalytics">
        <script type="application/json">
        {
            "vars": {
            "account": "UA-19416043-2"
            },
            "triggers": {
            "trackPageview": {
                "on": "visible",
                "request": "pageview"
            }
            }
        }
        </script>
    </amp-analytics>
</body>

</html>