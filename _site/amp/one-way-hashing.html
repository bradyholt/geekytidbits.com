<!doctype html>
<html amp lang="en">
<head>
    <meta charset="utf-8">
    <title>One-way Hashing in C#</title>
    <link rel="canonical" href="https://www.geekytidbits.com/one-way-hashing/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Poly' rel='stylesheet'>
    <style amp-custom>
        body { font-family: 'Poly', serif; }
        .site-header { background-color: #237ab2; color: #e7e9ec; padding: 5px; font-weight: 100; border-bottom: 3px solid #f68905; }
        .site-description { font-size: .5em;}        
        .post-content { padding: 10px; }
    </style>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
    <script async custom-element="amp-video" src="https://cdn.ampproject.org/v0/amp-video-0.1.js"></script>
    <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
</head>

<body>
    
    <h1 class="post-title">
        <header class="site-header">
    <div class="wrapper">
        <a class="site-title" href="/">
            <amp-img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo" layout="responsive"><noscript><img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo"></noscript></amp-img>
        </a>
        <div class="site-description">Tidbits on software development, technology, and other geeky stuff.</div>
    </div>
</header>

    </h1>
    <div class="post-content">
      <span>
          <i>Dec 30, 2010</i>
      </span>
      <p>Sensitive data stored in a database should always be encrypted. Sometimes sensitive data needs to be unencrypted for further processing such as when a credit card needs to be unencrypted occasionally to make a charge against it or when a social security number needs to be shown on a confidential report.</p>

<p>However, there are other scenarios when data should <em>never</em> be able to be unencrypted.  A perfect example of this is <strong>passwords</strong>.  With this type of data, a “one-way hash” should be generated which means using an algorithm to change the data in a way that it cannot be changed back.</p>

<h3 id="the-code">The code</h3>

<p>There are many ways to do this and I believe some are overly complicated.  Here is an easy way using the System.Security.Cryptography namespace.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">HashText</span><span class="p">(</span><span class="kt">string</span> <span class="n">text</span><span class="p">,</span> <span class="kt">string</span> <span class="n">salt</span><span class="p">,</span> <span class="n">HashAlgorithmType</span> <span class="n">hasher</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">byte</span><span class="p">[]</span> <span class="n">textWithSaltBytes</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">Concat</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">salt</span><span class="p">));</span>
    <span class="kt">byte</span><span class="p">[]</span> <span class="n">hashedBytes</span> <span class="p">=</span> <span class="n">hasher</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">textWithSaltBytes</span><span class="p">);</span>
    <span class="n">hasher</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToBase64String</span><span class="p">(</span><span class="n">hashedBytes</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The <strong>salt</strong> parameter is used to increase the strength of the hash and defend against <a href="http://www.google.com/search?q=rainbow+table+hack" target="_blank">Rainbow Table Attacks</a>.  The salt value can be any text but the strongest salt is one that changes with each hash.  For instance, when hashing a user’s password, use their username or database identifier as the salt.</p>

<h3 id="example-usage">Example usage</h3>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">string</span> <span class="n">password</span> <span class="p">=</span> <span class="s">"WeakPassword"</span><span class="p">;</span>
<span class="kt">string</span> <span class="n">salt</span> <span class="p">=</span> <span class="s">"MySecretSalt"</span><span class="p">;</span>
<span class="kt">string</span> <span class="n">hashedPassword</span> <span class="p">=</span> <span class="nf">HashText</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="k">new</span> <span class="nf">SHA1CryptoServiceProvider</span><span class="p">());</span>
</code></pre></div></div>

<p>Although I used the SHA1CryptoServiceProvider class to perform the hash, there are several others offered that will work fine too such as SHA512Managed and SHA384Managed. Do a Google search to determine the algorithm that meets your strength/performance needs.</p>

<h3 id="putting-it-to-use">Putting it to use</h3>

<p>If it is a password you are hashing, you should hash the value immediately after the user initially provides it to you (i.e. “Reset Your Password” page) and store the hashed value in the database.  Then, when they come back to your application and attempt to login with their password, you should re-hash the supplied password (with the original salt used!), compare to the stored hashed password and if they match, you should be safe to authenticate them.</p>

    </div>
    
    <footer class="site-footer">
    © 2019 Brady Holt
</footer>

    <amp-analytics type="googleanalytics">
        <script type="application/json">
        {
            "vars": {
            "account": "UA-19416043-2"
            },
            "triggers": {
            "trackPageview": {
                "on": "visible",
                "request": "pageview"
            }
            }
        }
        </script>
    </amp-analytics>
</body>

</html>