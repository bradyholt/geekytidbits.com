<!doctype html>
<html amp lang="en">
<head>
    <meta charset="utf-8">
    <title>NuGet Releases with Rake</title>
    <link rel="canonical" href="https://www.geekytidbits.com/nuget-releases-with-rake/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Poly' rel='stylesheet'>
    <style amp-custom>
        body { font-family: 'Poly', serif; }
        .site-header { background-color: #237ab2; color: #e7e9ec; padding: 5px; font-weight: 100; border-bottom: 3px solid #f68905; }
        .site-description { font-size: .5em;}        
        .post-content { padding: 10px; }
    </style>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
    <script async custom-element="amp-video" src="https://cdn.ampproject.org/v0/amp-video-0.1.js"></script>
    <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
</head>

<body>
    
    <h1 class="post-title">
        <header class="site-header">
    <div class="wrapper">
        <a class="site-title" href="/">
            <amp-img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo" layout="responsive"><noscript><img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo"></noscript></amp-img>
        </a>
        <div class="site-description">Tidbits on software development, technology, and other geeky stuff.</div>
    </div>
</header>

    </h1>
    <div class="post-content">
      <span>
          <i>Aug 28, 2013</i>
      </span>
      <p>Every time I want to release a new version of <a href="http://cronexpressiondescriptor.azurewebsites.net/" target="_blank">Cron Expression Descriptor</a> to NuGet, there is a bit of work to be done.  I had been planning on creating a MsBuild file to handle all the release tasks including <strong>versioning, building, packaging, pushing and tagging </strong>the Git repo but honestly, MsBuild is a pain to deal with because of its overly verbose XML syntax and need to install <a href="http://msbuildcontrib.codeplex.com/" target="_blank">MsBuild Contrib</a> to do anything beyond basic tasks.  Also, the installation process for MsBuild Contrib has always left a bad taste in my mouth: download zip, copy/paste to Program Files\… directory, add a bunch of XML to your .msbuild file to reference.</p>

<p>As I’ve been working with Rails more, I’ve become familiar with <a href="http://rake.rubyforge.org/" target="_blank">Rake</a>, the MsBuild equivalent for the Ruby world.  Also, at Austin Code Camp a few weeks ago I saw <a href="https://github.com/ot-chris-holt" target="_blank">Chris Holt</a> use Rake for some .NET builds “because it is easy”.  Searching around online, I found <a href="http://albacorebuild.net/" target="_blank">Albacore</a>, which provides a “suite of rake tasks that is intended to make building .NET systems easier”.  I decided to give Rake a shot for releasing Cron Expression Descriptor and it is working great.</p>

<p>The first thing I did was run ‘<strong>gem install albacore’ </strong>to install Albacore.  Then I <a href="http://nuget.org/nuget.exe" target="_blank">downloaded the NuGet command line utility</a>, placed it in a folder somewhere and added this folder to the path, so that nuget.exe could be executed from anywhere.  Also, I placed my <a href="https://github.com/bradymholt/cron-expression-descriptor/blob/master/build/pack/CronExpressionDescriptor.nuspec" target="_blank">.nuspec file</a> (previously generated by NuGet) in the project directory.  Once I added the following Rakefile in the <a href="https://github.com/bradymholt/cron-expression-descriptor/tree/master/build" target="_blank">same directory as my Cron Expression Descriptor project</a> I can simply run <strong>‘rake release[“1.7.0″]’,</strong> from the directory where my Rakefile resides,** **to release a new version of Cron Expression Descriptor to NuGet.</p>

<p>This Rakefile does all the dirty work including updating the AssemblyInfo with the <strong>version</strong> number (passed in as parameter), <strong>building</strong> in Release mode, <strong>packaging </strong>the NuGet package, <strong>pushing </strong>NuGet repository, and <strong>tagging</strong> my Git repository with the current release number.  Releases are a breeze now!</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Rakefile</span>
<span class="c1">#Example usage: rake release["1.7.0"]</span>

<span class="nb">require</span> <span class="s1">'albacore'</span>

<span class="n">project_name</span> <span class="o">=</span> <span class="s2">"CronExpressionDescriptor"</span>

<span class="n">task</span> <span class="ss">:version</span><span class="p">,</span> <span class="p">[</span><span class="ss">:version_number</span><span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
  <span class="n">desc</span> <span class="s2">"Version the assembly"</span>
    <span class="n">assemblyinfo</span> <span class="ss">:version</span> <span class="k">do</span> <span class="o">|</span><span class="n">asm</span><span class="o">|</span>
    <span class="n">asm</span><span class="p">.</span><span class="nf">version</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">version_number</span>
    <span class="n">asm</span><span class="p">.</span><span class="nf">file_version</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">version_number</span>
    <span class="n">asm</span><span class="p">.</span><span class="nf">input_file</span> <span class="o">=</span> <span class="s1">'./Properties/AssemblyInfo.cs'</span>
    <span class="n">asm</span><span class="p">.</span><span class="nf">output_file</span> <span class="o">=</span> <span class="s1">'./Properties/AssemblyInfo.cs'</span>
   <span class="k">end</span>
<span class="k">end</span>

<span class="n">task</span> <span class="ss">:build</span> <span class="k">do</span>
  <span class="n">desc</span> <span class="s1">'Build the solution in the Release configuration'</span>
  <span class="n">msbuild</span> <span class="ss">:build</span> <span class="k">do</span> <span class="o">|</span><span class="n">msb</span><span class="o">|</span>
    <span class="n">msb</span><span class="p">.</span><span class="nf">solution</span> <span class="o">=</span> <span class="n">project_name</span> <span class="o">+</span> <span class="s1">'.csproj'</span>
    <span class="n">msb</span><span class="p">.</span><span class="nf">targets</span> <span class="o">=</span> <span class="p">[</span> <span class="ss">:Clean</span><span class="p">,</span> <span class="ss">:Build</span> <span class="p">]</span>
    <span class="n">msb</span><span class="p">.</span><span class="nf">properties</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:Configuration</span> <span class="o">=&gt;</span> <span class="s1">'Release'</span> <span class="p">}</span>
   <span class="k">end</span>
<span class="k">end</span>

<span class="n">task</span> <span class="ss">:package</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="ss">:build</span><span class="p">]</span> <span class="k">do</span>
  <span class="n">desc</span> <span class="s2">"create the nuget package"</span>
  <span class="n">sh</span> <span class="s2">"nuget.exe pack </span><span class="si">#{</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.csproj -Prop Configuration=Release -OutputDirectory bin</span><span class="se">\\</span><span class="s2">Release -Verbosity normal"</span>
<span class="k">end</span>

<span class="n">task</span> <span class="ss">:push</span><span class="p">,</span> <span class="p">[</span><span class="ss">:version_number</span><span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
  <span class="n">sh</span> <span class="s2">"nuget.exe push bin</span><span class="se">\\</span><span class="s2">Release</span><span class="se">\\</span><span class="si">#{</span><span class="n">project_name</span><span class="si">}</span><span class="s2">.</span><span class="si">#{</span><span class="n">args</span><span class="p">.</span><span class="nf">version_number</span><span class="si">}</span><span class="s2">.nupkg"</span>
<span class="k">end</span>

<span class="n">task</span> <span class="ss">:tag</span><span class="p">,</span> <span class="p">[</span><span class="ss">:version_number</span><span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
  <span class="n">sh</span> <span class="s2">"git tag v</span><span class="si">#{</span><span class="n">args</span><span class="p">.</span><span class="nf">version_number</span><span class="si">}</span><span class="s2">"</span>
  <span class="n">sh</span> <span class="s2">"git push --tags"</span>
<span class="k">end</span>

<span class="n">task</span> <span class="ss">:release</span><span class="p">,</span> <span class="p">[</span><span class="ss">:version_number</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="ss">:version</span><span class="p">,</span> <span class="ss">:package</span><span class="p">,</span> <span class="ss">:push</span><span class="p">,</span> <span class="ss">:tag</span><span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
  <span class="n">desc</span> <span class="s2">"v</span><span class="si">#{</span><span class="n">args</span><span class="p">.</span><span class="nf">version_number</span><span class="si">}</span><span class="s2"> Released!"</span>
<span class="k">end</span>
</code></pre></div></div>

    </div>
    
    <footer class="site-footer">
    © 2019 Brady Holt
</footer>

    <amp-analytics type="googleanalytics">
        <script type="application/json">
        {
            "vars": {
            "account": "UA-19416043-2"
            },
            "triggers": {
            "trackPageview": {
                "on": "visible",
                "request": "pageview"
            }
            }
        }
        </script>
    </amp-analytics>
</body>

</html>