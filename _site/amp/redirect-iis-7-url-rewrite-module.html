<!doctype html>
<html amp lang="en">
<head>
    <meta charset="utf-8">
    <title>Redirecting Old Pages with IIS 7 and the URL Rewrite Module</title>
    <link rel="canonical" href="https://www.geekytidbits.com/redirect-iis-7-url-rewrite-module/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Poly' rel='stylesheet'>
    <style amp-custom>
        body { font-family: 'Poly', serif; }
        .site-header { background-color: #237ab2; color: #e7e9ec; padding: 5px; font-weight: 100; border-bottom: 3px solid #f68905; }
        .site-description { font-size: .5em;}        
        .post-content { padding: 10px; }
    </style>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
    <script async custom-element="amp-video" src="https://cdn.ampproject.org/v0/amp-video-0.1.js"></script>
    <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
</head>

<body>
    
    <h1 class="post-title">
        <header class="site-header">
    <div class="wrapper">
        <a class="site-title" href="/">
            <amp-img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo" layout="responsive"><noscript><img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo"></noscript></amp-img>
        </a>
        <div class="site-description">Tidbits on software development, technology, and other geeky stuff.</div>
    </div>
</header>

    </h1>
    <div class="post-content">
      <span>
          <i>Mar 7, 2012</i>
      </span>
      <p>I am a change-a-holic.  I am constantly changing, re-factoring, deleting, moving, renaming, etc. all in the name of <strong><em>progress</em></strong>.  It’s intentional, of course, and I learned to embrace change when I started following the principles of <a href="http://www.extremeprogramming.org/" target="_blank">Extreme Programming</a> like <a href="http://www.extremeprogramming.org/rules/refactor.html" target="_blank">Refactor Mercilessly</a>.</p>

<p>An elegant way to handle change when it comes to renaming and moving pages around within an ASP.NET web application is to take advantage of the IIS 7 Rewrite module.  With this strategy in place I can easily add redirects to a single xml file and update it as needed.</p>

<p>Here’s how to get it setup:</p>

<ul>
  <li>Make sure you have the <a href="http://www.iis.net/download/URLRewrite" target="_blank">URL Rewrite module</a> installed in IIS 7.</li>
  <li>
    <p>Add a file called <code class="highlighter-rouge">Web.RewriteMaps.config</code> to your web application root.  This is the file that will contain all your redirect mappings.  It should look like this:</p>

    <div class="language-xml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nt">&lt;rewriteMaps&gt;</span>
  <span class="nt">&lt;rewriteMap</span> <span class="na">name=</span><span class="s">"OldPages"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">"/oldpage.aspx"</span> <span class="na">value=</span><span class="s">"/newstuff/newpage.aspx"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">"/legacy/really_old.aspx"</span> <span class="na">value=</span><span class="s">"/BrandNew.aspx"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/rewriteMap&gt;</span>
<span class="nt">&lt;/rewriteMaps&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Add the following to the <code class="highlighter-rouge">&lt;system.webServer/&gt;</code> section of your <code class="highlighter-rouge">web.config</code> file.  If you already have a <code class="highlighter-rouge">&lt;rewrite/&gt;</code> section don’t duplicate but merge the following in.</p>

    <div class="language-xml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nt">&lt;rewrite&gt;</span>
  <span class="nt">&lt;rewriteMaps</span> <span class="na">configSource=</span><span class="s">"Web.RewriteMaps.config"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;rules&gt;</span>
    <span class="nt">&lt;rule</span> <span class="na">name=</span><span class="s">"Old Page Redirects"</span> <span class="na">stopProcessing=</span><span class="s">"true"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;match</span> <span class="na">url=</span><span class="s">".*"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;conditions&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">input=</span><span class="s">"{OldPages:{REQUEST_URI}}"</span> <span class="na">pattern=</span><span class="s">"(.+)"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/conditions&gt;</span>
      <span class="nt">&lt;action</span> <span class="na">type=</span><span class="s">"Redirect"</span> <span class="na">url=</span><span class="s">"{C:1}"</span> <span class="na">appendQueryString=</span><span class="s">"false"</span> <span class="na">redirectType=</span><span class="s">"Permanent"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/rule&gt;</span>
  <span class="nt">&lt;/rules&gt;</span>
<span class="nt">&lt;/rewrite&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>That’s it.  Now IIS will read you <code class="highlighter-rouge">Web.RewriteMaps.config</code> file and perform a <code class="highlighter-rouge">301 Moved Permanently</code> on all your old pages and redirect the user to the new page.</li>
</ul>

    </div>
    
    <footer class="site-footer">
    © 2019 Brady Holt
</footer>

    <amp-analytics type="googleanalytics">
        <script type="application/json">
        {
            "vars": {
            "account": "UA-19416043-2"
            },
            "triggers": {
            "trackPageview": {
                "on": "visible",
                "request": "pageview"
            }
            }
        }
        </script>
    </amp-analytics>
</body>

</html>