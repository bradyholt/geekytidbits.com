<!doctype html>
<html amp lang="en">
<head>
    <meta charset="utf-8">
    <title>jQuery, Ajax and ASP.NET Web Server Controls</title>
    <link rel="canonical" href="https://www.geekytidbits.com/jquery-ajax-asp-net-web-server-controls/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Poly' rel='stylesheet'>
    <style amp-custom>
        body { font-family: 'Poly', serif; }
        .site-header { background-color: #237ab2; color: #e7e9ec; padding: 5px; font-weight: 100; border-bottom: 3px solid #f68905; }
        .site-description { font-size: .5em;}        
        .post-content { padding: 10px; }
    </style>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
    <script async custom-element="amp-video" src="https://cdn.ampproject.org/v0/amp-video-0.1.js"></script>
    <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
</head>

<body>
    
    <h1 class="post-title">
        <header class="site-header">
    <div class="wrapper">
        <a class="site-title" href="/">
            <amp-img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo" layout="responsive"><noscript><img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo"></noscript></amp-img>
        </a>
        <div class="site-description">Tidbits on software development, technology, and other geeky stuff.</div>
    </div>
</header>

    </h1>
    <div class="post-content">
      <span>
          <i>Oct 19, 2011</i>
      </span>
      <p>I have been a pretty heavy user of the ASP.NET AJAX UpdatePanel. It makes Ajax ridiculously easy. You just drop a ScriptManager and UpdatePanel on a page and you magically have Ajax. But, as I have been paying more and more attention to the resulting page markup and payload size of the XMLHttpRequest / XMLHttpResponse calls, I have been raising my eyebrow. Fire up &lt;a href=”http://getfirebug.com/” target=”_blank”&gt;FireBugor <a href="http://www.fiddler2.com/fiddler2/" target="_blank">Fiddler</a> and have a look. That’s a whole bunch of data traveling back and forth just to update a portion of the page. The overhead of the UpdatePanel is very large. I’ve always thought the UpdatePanel seemed a bit sluggish but deemed it acceptable in light of how easy it is to setup and use. As web applications are getting better and faster each day I have been looking around for another solution that has less overhead but it still easy to use.</p>

<p>Over the last year or so I have been embracing the <a href="http://jquery.com/" target="_blank">jQuery</a> JavaScript library. It generally takes the pain out of JavaScript and has great Ajax support. I have learned to really love it. One of the pain points I ran into with using jQuery with ASP.NET, though, was partial updates of Web Server controls (like a GridView or Repeater). Since server controls are required by ASP.NET to be inside of a form tag in an .aspx page or in a UserControl included on the page, this was problematic as partial updates using &lt;a href=”http://api.jquery.com/load/” target=”_blank”&gt;jQuery .load()&lt;/a&gt; should only contain html fragments. If the fragment contains a form tag then a second form would be added to the parent page DOM and make ASP.NET freak out because there is more than one form on the page. It gets ugly fast.</p>

<p>One way around this would be to use <a href="http://api.jquery.com/jQuery.ajax/" target="_blank">jQuery.ajax()</a> and return xml/json data to the browser, parse it, and manipulate the DOM to update the data. This is painful though and completely defeats the purpose of having server controls at all. If I’m going to go through the pain of parsing xml/json and rebuilding the DOM elements I might as well skip the server control altogether.</p>

<h3 id="solution">Solution</h3>

<p>I finally came upon a great solution to this problem after searching around and putting 2 and 2 together. Simply drop your Web Server control on an .aspx page, strip all the HTML before and after it (including the form runat=”server” tag but leave the &lt;%@ Page directive at the top), and override the System.Web.UI.Page.VerifyRenderingInServerForm method with an empty block. The allows ASP.NET to render the control as an HTML fragment and not throw an exception because it isn’t contained within a form.</p>

<h4 id="animalsaspx">Animals.aspx</h4>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;</span><span class="err">%@</span> <span class="na">Page</span> <span class="na">Language=</span><span class="s">"C#"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
     <span class="nt">&lt;title&gt;</span>Animals<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
        <span class="kd">var</span> <span class="nx">AnimalDataHelper</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">update</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="s1">'#animals'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'Loading...'</span><span class="p">);</span>
                <span class="nx">$</span><span class="p">(</span><span class="s1">'#animals'</span><span class="p">).</span><span class="nx">load</span><span class="p">(</span><span class="s1">'AnimalDataPartial.aspx'</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">AnimalDataHelper</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">'#refresh'</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">AnimalDataHelper</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>
            <span class="p">});</span>
        <span class="p">});</span>
    <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"form1"</span> <span class="na">runat=</span><span class="s">"server"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">id=</span><span class="s">"refresh"</span> <span class="na">value=</span><span class="s">"Update"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"animals"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<h4 id="animaldatapartialaspx">AnimalDataPartial.aspx</h4>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;</span><span class="err">%@</span> <span class="na">Page</span> <span class="na">Language=</span><span class="s">"C#"</span><span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;script </span><span class="na">runat=</span><span class="s">"server"</span><span class="nt">&gt;</span>
   <span class="kr">protected</span> <span class="k">void</span> <span class="nx">Page_Load</span><span class="p">(</span><span class="nx">object</span> <span class="nx">sender</span><span class="p">,</span> <span class="nx">EventArgs</span> <span class="nx">e</span><span class="p">)</span>
   <span class="p">{</span>
     <span class="nx">List</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">List</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span> <span class="s2">"dog"</span><span class="p">,</span> <span class="s2">"cat"</span><span class="p">,</span> <span class="s2">"monkey"</span> <span class="p">};</span>
     <span class="nx">animalsGrid</span><span class="p">.</span><span class="nx">DataSource</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
     <span class="nx">animalsGrid</span><span class="p">.</span><span class="nx">DataBind</span><span class="p">();</span>
   <span class="p">}</span>

   <span class="kr">public</span> <span class="nx">override</span> <span class="k">void</span> <span class="nx">VerifyRenderingInServerForm</span><span class="p">(</span><span class="nx">Control</span> <span class="nx">control</span><span class="p">)</span>
   <span class="p">{</span>
     <span class="c1">//DO NOT REMOVE THIS METHOD</span>
     <span class="c1">//allows web server controls to not be in form runat='server'</span>
   <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;asp:GridView</span> <span class="na">runat=</span><span class="s">"server"</span> <span class="na">ID=</span><span class="s">"animalsGrid"</span> <span class="na">AutoGenerateColumns=</span><span class="s">"true"</span><span class="nt">&gt;&lt;/asp:GridView&gt;</span>
Last Updated: <span class="nt">&lt;</span><span class="err">%=</span><span class="na">DateTime</span><span class="err">.</span><span class="na">Now</span><span class="err">.</span><span class="na">ToLongTimeString</span><span class="err">()</span> <span class="err">%</span><span class="nt">&gt;</span>
</code></pre></div></div>

<h3 id="wrapping-up">Wrapping Up</h3>

<p>There you have it. The power of ASP.NET web server controls, jQuery, and Ajax combined. This solution is slightly more work than using an ASP.NET AJAX UpdatePanel but it is <em>much</em> snappier, uses <em>way</em> less data payload in the asynchronous request/response, and gives you more control of things. It’s a pretty nice combination I must say.</p>

    </div>
    
    <footer class="site-footer">
    © 2019 Brady Holt
</footer>

    <amp-analytics type="googleanalytics">
        <script type="application/json">
        {
            "vars": {
            "account": "UA-19416043-2"
            },
            "triggers": {
            "trackPageview": {
                "on": "visible",
                "request": "pageview"
            }
            }
        }
        </script>
    </amp-analytics>
</body>

</html>