<!doctype html>
<html amp lang="en">
<head>
    <meta charset="utf-8">
    <title>Unattended Audio Recordings with a Raspberry Pi</title>
    <link rel="canonical" href="https://www.geekytidbits.com/raspberry-pi-unattended-audio-recordings/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Poly' rel='stylesheet'>
    <style amp-custom>
        body { font-family: 'Poly', serif; }
        .site-header { background-color: #237ab2; color: #e7e9ec; padding: 5px; font-weight: 100; border-bottom: 3px solid #f68905; }
        .site-description { font-size: .5em;}        
        .post-content { padding: 10px; }
    </style>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
    <script async custom-element="amp-video" src="https://cdn.ampproject.org/v0/amp-video-0.1.js"></script>
    <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
</head>

<body>
    
    <h1 class="post-title">
        <header class="site-header">
    <div class="wrapper">
        <a class="site-title" href="/">
            <amp-img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo" layout="responsive"><noscript><img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo"></noscript></amp-img>
        </a>
        <div class="site-description">Tidbits on software development, technology, and other geeky stuff.</div>
    </div>
</header>

    </h1>
    <div class="post-content">
      <span>
          <i>Feb 1, 2013</i>
      </span>
      <p>Have you heard about the new Raspberry Pi computer?  From the <a href="http://www.raspberrypi.org/" target="_blank">website</a>: “The Raspberry Pi is a credit-card sized computer that plugs into your TV and a keyboard. It’s a capable little PC which can be used for many of the things that your desktop PC does, like spreadsheets, word-processing and games. It also plays high-definition video.”</p>

<p><strong>Basically, it’s an insanely cheap computer ($35) that you can do all sorts of geeky things with.  Go get one NOW (and then come back).</strong></p>

<p>I waited 3 long months for my Raspberry Pi to arrive after ordering and boy was it was worth the wait!  I love this little thing.  I loaded the recommended image “Wheezy” on it and played around for awhile before quickly moving to <a href="http://archlinuxarm.org/platforms/armv6/raspberry-pi" target="_blank">Arch Linux ARM</a> which I know well since I’ve had it running on my <a href="/my-pogoplug-geek-toy/" target="_blank">PogoPlug</a> for almost 2 years.</p>

<p>After tinkering for awhile I kept trying to come up with a project for it.  There are<a href="http://pingbin.com/2012/12/30-cool-ideas-raspberry-pi-project/" target="_blank"> so many cool Raspberry Pi projects</a> out there right now and it’s easy to get excited about tackling one of them.  I’ve had my eye on the <a href="http://www.daveakerman.com/?p=592" target="_blank">High Altitude Ballooning Pi project</a> where you send your Pi to space to take pictures and track its movement with GPS.  Come on now, tell me that isn’t cool.</p>

<p>Anyway, I finally came up with an idea for a project.  I am responsible for recording the Sunday morning lesson in our church Sunday school class.  For the last 3 years the Sunday morning process has been to buy and bring CDRs, queue up the mic and recording system setup in the room, take the CDR home, rip it, encode the WAV to MP3 and upload it so it is available for Podcasting.  Whew, that’s a lot of steps.  Because it’s such a cumbersome process, it’s been hard to keep up with and easy to “forget” from time to time.  Also, it’s hard to train other volunteers on how to do the process end-to-end.  Since we already have a nice high quality microphone and mic amp setup in the room, I thought I would use the Pi to automatically record the audio and make it available as a Podcast.</p>

<p><a href="/media/IMG_0037.jpg"><amp-img class="wp-image-1359" alt="IMG_0037" src="/media/IMG_0037.jpg" width="592" height="443" layout="responsive"><noscript><img class="wp-image-1359" alt="IMG_0037" src="/media/IMG_0037.jpg" width="592" height="443"></noscript></amp-img></a></p>

<p>So, that’s exactly what I did.  It turned out to be a fun project and has been working for the last couple of weeks.  I found an old USB Belkin Wireless G Adapter (F5D7050/v4000) lying around which I used for wifi connectivity to our church’s wifi hotspot.  Since the Pi doesn’t have mic input capability I bought a $10 USB Sabrent sound card w/ mic input (SBCV/UP-100) from Micro Center which was easy to get up and working with the help of the <a href="https://wiki.archlinux.org/index.php/Advanced_Linux_Sound_Architecture" target="_blank">ALSA guide on the Arch Linux wiki</a>.   I bought an RCA to 3.5mm audio cable to hook up the mic amp output to the 3.5mm mic input on the USB sound card.</p>

<p>I have cron running the following script every Sunday morning at 11:00AM (when class starts) to record for one hour (podcast-record.sh 3600).  Obviously, I took out my credentials and such but this should be enough to give you an idea of what I’m doing.  This script does the following:</p>

<ul>
  <li>Record audio from mic using arecord</li>
  <li>Use sox to convert stereo to mono for smaller file size</li>
  <li>Use lame to encode to mp3 at 64kbps bit rate</li>
  <li>Upload to Amazon S3 storage</li>
  <li>Write a record to my mysql database.  I have a web app running on top of this database that generates the podcast xml feed.</li>
  <li>Send a ‘success’ email notifying me it all worked</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Unattended podcast record process</span>
<span class="c"># Author: brady@geekytidbits.com</span>
<span class="c"># Notes: Invoke with seconds parameter specifying how many seconds to record, ex. 'podcast-record.sh 10'</span>

<span class="nv">FILENAME</span><span class="o">=</span><span class="k">$(</span><span class="nb">date</span> +<span class="s2">"%Y%m%d_%H%M"</span><span class="k">)</span>

<span class="c">#record with sudo since arecord seems to want root privledges</span>
<span class="nb">sudo </span>arecord <span class="nt">-f</span> dat <span class="nt">-d</span> <span class="nv">$1</span> ./record/<span class="k">${</span><span class="nv">FILENAME</span><span class="k">}</span>.wav
<span class="o">[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>

<span class="c">#change ownership to jdoe</span>
<span class="nb">sudo chown </span>jdoe ./record/<span class="k">${</span><span class="nv">FILENAME</span><span class="k">}</span>.wav
<span class="o">[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>

<span class="c">#copy to process directory</span>
<span class="nb">cp</span> ./record/<span class="k">${</span><span class="nv">FILENAME</span><span class="k">}</span>.wav ./process/<span class="k">${</span><span class="nv">FILENAME</span><span class="k">}</span>.wav

<span class="c">#stereo &amp;gt; mono</span>
sox ./process/<span class="k">${</span><span class="nv">FILENAME</span><span class="k">}</span>.wav <span class="nt">-c</span> 1 ./process/<span class="k">${</span><span class="nv">FILENAME</span><span class="k">}</span><span class="nt">-mono</span>.wav

<span class="c">#convert to mp3 (64Kpbs)</span>
lame <span class="nt">-b</span> 64 ./process/<span class="k">${</span><span class="nv">FILENAME</span><span class="k">}</span><span class="nt">-mono</span>.wav ./upload/<span class="k">${</span><span class="nv">FILENAME</span><span class="k">}</span>.mp3
<span class="o">[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>

<span class="c">#remove process files</span>
<span class="nb">rm</span> ./record/<span class="k">${</span><span class="nv">FILENAME</span><span class="k">}</span>.wav
<span class="nb">rm</span> ./process/<span class="k">${</span><span class="nv">FILENAME</span><span class="k">}</span>.wav
<span class="nb">rm</span> ./process/<span class="k">${</span><span class="nv">FILENAME</span><span class="k">}</span><span class="nt">-mono</span>.wav

<span class="nv">NOTIFY_EMAIL</span><span class="o">=</span>MY_EMAIL_ADDRESS@gmail.com
<span class="nv">MODTIME</span><span class="o">=</span><span class="k">$(</span><span class="nb">stat</span> <span class="nt">-c</span> %y ./upload/<span class="k">${</span><span class="nv">FILENAME</span><span class="k">}</span>.mp3<span class="k">)</span>
<span class="nv">DATE</span><span class="o">=</span><span class="k">$(</span><span class="nb">date</span> <span class="nt">--date</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">MODTIME</span><span class="k">}</span><span class="s2">"</span> +%Y-%m-%d<span class="k">)</span>

<span class="c">#upload to s3</span>
s3cmd put <span class="nt">--reduced-redundancy</span> <span class="nt">--acl-public</span> ./upload/<span class="k">${</span><span class="nv">FILENAME</span><span class="k">}</span>.mp3 s3://MY_S3_BUCKET/<span class="k">${</span><span class="nv">FILENAME</span><span class="k">}</span>.mp3
<span class="o">[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]</span> <span class="o">||</span> <span class="k">continue</span>

<span class="c">#write db record</span>
mysql <span class="nt">-h</span> www.mydomain.com <span class="nt">-D</span> MY_DB_NAME <span class="nt">-u</span> MY_DB_USERNAME <span class="nt">-pMY_DB_PASSWORD</span> <span class="nt">--execute</span> <span class="s2">"INSERT INTO Lesson (Date, Title, Speaker, Audio_File_Name) VALUES ('</span><span class="k">${</span><span class="nv">DATE</span><span class="k">}</span><span class="s2">', 'TBD', 'TBD', '</span><span class="k">${</span><span class="nv">FILENAME</span><span class="k">}</span><span class="s2">.mp3')"</span>
<span class="o">[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]</span> <span class="o">||</span> <span class="k">continue

</span><span class="nb">mv</span> ./upload/<span class="k">${</span><span class="nv">FILENAME</span><span class="k">}</span>.mp3 ./complete/

<span class="c">#send email</span>
<span class="nb">echo</span> <span class="s2">"Done!"</span> | mail <span class="nt">-s</span> <span class="s2">"Podcast </span><span class="k">${</span><span class="nv">DATE</span><span class="k">}</span><span class="s2"> - Upload Complete"</span> <span class="nv">$NOTIFY_EMAIL</span>
</code></pre></div></div>

<p>To install all the dependencies used in this script simply run the following:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacman <span class="nt">-S</span> <span class="nb">sudo </span>alsa-utils sox lame s3cmd mysql
</code></pre></div></div>

<p>There you have it.  That was fun.  Now go get a Pi of your own and do something fun with it.</p>


    </div>
    
    <footer class="site-footer">
    © 2019 Brady Holt
</footer>

    <amp-analytics type="googleanalytics">
        <script type="application/json">
        {
            "vars": {
            "account": "UA-19416043-2"
            },
            "triggers": {
            "trackPageview": {
                "on": "visible",
                "request": "pageview"
            }
            }
        }
        </script>
    </amp-analytics>
</body>

</html>