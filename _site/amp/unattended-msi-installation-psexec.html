<!doctype html>
<html amp lang="en">
<head>
    <meta charset="utf-8">
    <title>Remote Unattended MSI Installation with PsExec</title>
    <link rel="canonical" href="https://www.geekytidbits.com/unattended-msi-installation-psexec/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Poly' rel='stylesheet'>
    <style amp-custom>
        body { font-family: 'Poly', serif; }
        .site-header { background-color: #237ab2; color: #e7e9ec; padding: 5px; font-weight: 100; border-bottom: 3px solid #f68905; }
        .site-description { font-size: .5em;}        
        .post-content { padding: 10px; }
    </style>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
    <script async custom-element="amp-video" src="https://cdn.ampproject.org/v0/amp-video-0.1.js"></script>
    <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
</head>

<body>
    
    <h1 class="post-title">
        <header class="site-header">
    <div class="wrapper">
        <a class="site-title" href="/">
            <amp-img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo" layout="responsive"><noscript><img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo"></noscript></amp-img>
        </a>
        <div class="site-description">Tidbits on software development, technology, and other geeky stuff.</div>
    </div>
</header>

    </h1>
    <div class="post-content">
      <span>
          <i>Jun 28, 2011</i>
      </span>
      <p>I recently had the need to remotely install a freshly built MSI to a remote Windows Server machine using the powerful command-line tool <a href="http://technet.microsoft.com/en-us/sysinternals/bb897553" target="_blank">PsExec</a>.  At first I thought this would be easy but I ran into some issues that had me banging my head for hours.  I was able to install the MSI from the command line when logged into the target machine directly with no issue but trying to do it remotely with psexec was resulting in very strange behavior.  I finally found that I needed to use the** -e** and <strong>-s</strong> parameters of PsExec or else I would get msiexec errors like <a href="http://support.microsoft.com/kb/229683" target="_blank">1612</a> or <a href="http://support.microsoft.com/kb/229683" target="_blank">1638</a>.  If you don’t use those parameters, PsExec will execute the command without the full user account context and msiexec does not like that.</p>

<p>My approach is to copy the MSI to the target server (net use, copy), uninstall and then install (psexec, msiexec)  Here are the commands I am using which work like a charm.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>net use <span class="se">\\</span>SERVER1<span class="se">\c</span><span class="nv">$\</span>Windows<span class="se">\T</span>emp AdminPassword /user:Admin
copy /Y C:<span class="se">\b</span>uild<span class="se">\M</span>yApp.msi <span class="se">\\</span>SERVER1<span class="se">\c</span><span class="nv">$\</span>Windows<span class="se">\T</span>emp
psexec.exe <span class="se">\\</span>SERVER1 <span class="nt">-u</span> Admin <span class="nt">-p</span> AdminPassword <span class="nt">-e</span> <span class="nt">-s</span> msiexec /x <span class="o">{</span>61EF76AE-6CC9-4EFC-B788-6845C0BCEF00<span class="o">}</span> /quiet
psexec.exe <span class="se">\\</span>SERVER1 <span class="nt">-e</span> <span class="nt">-s</span> <span class="nt">-u</span> Admin <span class="nt">-p</span> AdminPassword msiexec /i C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\M</span>yApp.msi <span class="nv">TARGETDIR</span><span class="o">=</span>C:<span class="se">\M</span>yApp /quiet
net use <span class="se">\\</span>SERVER1<span class="se">\c</span><span class="nv">$\</span>Windows<span class="se">\T</span>emp /d
</code></pre></div></div>

    </div>
    
    <footer class="site-footer">
    © 2019 Brady Holt
</footer>

    <amp-analytics type="googleanalytics">
        <script type="application/json">
        {
            "vars": {
            "account": "UA-19416043-2"
            },
            "triggers": {
            "trackPageview": {
                "on": "visible",
                "request": "pageview"
            }
            }
        }
        </script>
    </amp-analytics>
</body>

</html>