<!doctype html>
<html amp lang="en">
<head>
    <meta charset="utf-8">
    <title>Testing class-style Vue.js components with Mocha and TypeScript</title>
    <link rel="canonical" href="https://www.geekytidbits.com/test-vuejs-with-mocha-typescript/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Poly' rel='stylesheet'>
    <style amp-custom>
        body { font-family: 'Poly', serif; }
        .site-header { background-color: #237ab2; color: #e7e9ec; padding: 5px; font-weight: 100; border-bottom: 3px solid #f68905; }
        .site-description { font-size: .5em;}        
        .post-content { padding: 10px; }
    </style>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
    <script async custom-element="amp-video" src="https://cdn.ampproject.org/v0/amp-video-0.1.js"></script>
    <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
</head>

<body>
    
    <h1 class="post-title">
        <header class="site-header">
    <div class="wrapper">
        <a class="site-title" href="/">
            <amp-img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo" layout="responsive"><noscript><img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo"></noscript></amp-img>
        </a>
        <div class="site-description">Tidbits on software development, technology, and other geeky stuff.</div>
    </div>
</header>

    </h1>
    <div class="post-content">
      <span>
          <i>Jul 31, 2017</i>
      </span>
      <p>While working on my <a href="https://www.geekytidbits.com/koa-vue-template/">Koa / Vue.js SPA Template</a>, I had a bit of trouble testing my <a href="https://github.com/vuejs/vue-class-component">class-style</a> Vue.js components with Mocha. I eventually figured it out but there were quite a few moving pieces and it felt messy. So, I worked to simplify the process and eventually came up with a pattern I am quite happy with. I extracted the pattern into a standalone repository called <a href="https://github.com/bradymholt/vuejs-test-mocha-typescript-example">vuejs-test-mocha-typescript-example</a>.</p>

<p>The <a href="https://vuejs.org/v2/guide/unit-testing.html">Unit Testing guide</a> for Vue.js does an excellent job explaining how to test components but if you are utilitizing vue-class-component decorators to use class-style components, testing does require a slightly different setup. Additionally, if you use single file components you need to run the components through webpack before testing with Mocha. And, if you want to run the tests from Node rather than a browser (via something like Karma), you need to mock the DOM for Vue.</p>

<p>This pattern uses <a href="https://github.com/tmpvar/jsdom">jsdom</a> to mock the browser DOM from within the Node environment and then <a href="https://github.com/zinserjan/mocha-webpack">mocha-webpack</a> to run the Vue single file components through webpack <em>on-the-fly</em> during a test run.</p>

<p>In the repository, there is an example unit test for the <code class="highlighter-rouge">HelloWorld</code> component, defined as:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="s2">"HelloWorld"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Inspect the component instance on mount</span>
  <span class="nx">it</span><span class="p">(</span><span class="s2">"correctly sets the foobar value when created"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">foobar</span> <span class="o">=</span> <span class="s2">"fooboo"</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">ctor</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">HelloWorld</span><span class="p">);</span>
    <span class="kd">const</span> <span class="na">vm</span><span class="p">:</span> <span class="nx">any</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ctor</span><span class="p">({</span> <span class="na">propsData</span><span class="p">:</span> <span class="p">{</span> <span class="nx">foobar</span> <span class="p">}</span> <span class="p">}).</span><span class="nx">$mount</span><span class="p">();</span>

    <span class="nx">assert</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">foobar</span><span class="p">,</span> <span class="nx">foobar</span><span class="p">);</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">textContent</span><span class="p">,</span> <span class="s2">`value specified of </span><span class="p">${</span><span class="nx">foobar</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Running <code class="highlighter-rouge">npm test</code> will run the test suite and print the results.</p>

<p>I am happy with this setup and will be using it for my Vue.js projects going forward.</p>

<p>The example code repository is located here: <a href="https://github.com/bradymholt/vuejs-test-mocha-typescript-example">https://github.com/bradymholt/vuejs-test-mocha-typescript-example</a>.</p>

    </div>
    
    <footer class="site-footer">
    Â© 2019 Brady Holt
</footer>

    <amp-analytics type="googleanalytics">
        <script type="application/json">
        {
            "vars": {
            "account": "UA-19416043-2"
            },
            "triggers": {
            "trackPageview": {
                "on": "visible",
                "request": "pageview"
            }
            }
        }
        </script>
    </amp-analytics>
</body>

</html>