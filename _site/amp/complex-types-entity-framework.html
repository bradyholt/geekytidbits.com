<!doctype html>
<html amp lang="en">
<head>
    <meta charset="utf-8">
    <title>Complex Types in Entity Framework (Code First)</title>
    <link rel="canonical" href="https://www.geekytidbits.com/complex-types-entity-framework/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Poly' rel='stylesheet'>
    <style amp-custom>
        body { font-family: 'Poly', serif; }
        .site-header { background-color: #237ab2; color: #e7e9ec; padding: 5px; font-weight: 100; border-bottom: 3px solid #f68905; }
        .site-description { font-size: .5em;}        
        .post-content { padding: 10px; }
    </style>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
    <script async custom-element="amp-video" src="https://cdn.ampproject.org/v0/amp-video-0.1.js"></script>
    <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
</head>

<body>
    
    <h1 class="post-title">
        <header class="site-header">
    <div class="wrapper">
        <a class="site-title" href="/">
            <amp-img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo" layout="responsive"><noscript><img src="/media/geekytidbits.png" width="383" height="46" alt="Geeky Tidbits Logo"></noscript></amp-img>
        </a>
        <div class="site-description">Tidbits on software development, technology, and other geeky stuff.</div>
    </div>
</header>

    </h1>
    <div class="post-content">
      <span>
          <i>Jul 2, 2014</i>
      </span>
      <p>Last week I gave a <a href="/entity-framework-tech-talk/">tech talk on Entity Framework</a>. One of the questions that was asked at the end of the talk was how to handle “complex types”.   That is, how to get Entity Framework to map data into a container “child object” correctly.  A couple of reasons you might want to do this are: to organize your model classes in a cleaner way and also to isolate data for serialization.  For example, if you have a database table called Person that includes address related fields, you might want to create an Address class and have EF map just the address fields in this type.  This gives you flexibility so that, for example, you could serialize the address info to JSON without having to ‘ignore’ a bunch of other fields you don’t want serialized.</p>

<p>I had to dig around a bit to figure out how to get it to work but it is definitely possible.  You just need to:</p>

<ul>
  <li>Define the complex type class</li>
  <li>Decorate the type with  <code class="highlighter-rouge">[ComplexType]</code>
</li>
  <li>Add a member of this type to the container type (i.e. add Address property to Person class)</li>
  <li>Make sure the type is always instantiated (either at declaration or in constructor).  This seems a bit odd but if you don’t do this EF will throw an exception at runtime.</li>
</ul>

<p>The article <a href="http://weblogs.asp.net/manavi/entity-association-mapping-with-code-first-part-1-one-to-one-associations">Associations in EF Code First CTP5: Part 1 – Complex Types</a> was definitely helpful with understanding this.</p>

<p>Here is a gist demonstrating what it looks like.</p>

<p><em>ef-complextypes.cs</em></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Person</span> <span class="p">{</span>
  <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="k">set</span><span class="p">;}</span>
  <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span>  <span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="k">set</span><span class="p">;}</span>
  <span class="k">public</span> <span class="n">Address</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Address</span><span class="p">();</span>   <span class="c1">// &lt;&lt; It's important to instantiate Address.</span>
<span class="p">}</span>

<span class="na">[ComplexType]</span>  <span class="c1">// &lt;&lt;  This attribute is important.</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">Address</span> <span class="p">{</span>
  <span class="k">public</span> <span class="kt">string</span> <span class="n">Address1</span> <span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="k">set</span><span class="p">;}</span>
  <span class="k">public</span> <span class="kt">string</span> <span class="n">Address2</span> <span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="k">set</span><span class="p">;}</span>
  <span class="k">public</span> <span class="kt">string</span> <span class="n">City</span> <span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="k">set</span><span class="p">;}</span>
<span class="p">}</span>

<span class="cm">/*Example usage:
   Person p = new Person();
   p.Address.Address1 = "1848 Willow Drive";
   p.Address.Address2 = "Unit 105";
   p.Address.Address1 = "Houston";
*/</span>

<span class="cm">/*  Table structure
   dbo.Person
      FirstName varchar(50),
      LastName varchar(50),
      Address1 varchar(50),
      Address2 varchar(50),
      City varchar(50)
*/</span>
</code></pre></div></div>


    </div>
    
    <footer class="site-footer">
    © 2019 Brady Holt
</footer>

    <amp-analytics type="googleanalytics">
        <script type="application/json">
        {
            "vars": {
            "account": "UA-19416043-2"
            },
            "triggers": {
            "trackPageview": {
                "on": "visible",
                "request": "pageview"
            }
            }
        }
        </script>
    </amp-analytics>
</body>

</html>